%h1.header
  Listado de Compras
%hr
.row
  .col-md-4.col-xs-5
    = link_to new_purchase_path, class: 'btn btn-raised btn-success' do
      %i.fa.fa-plus-circle
      Nueva Compra
    = link_to new_purchase_path, class: 'btn btn-info' do
      %i.fa.fa-edit
      Compras Desactivadas
  .col-md-8.col-xs-7
    = form_tag(purchases_path(), :method => "get", id: "search-form") do
      .row
        .col-md-7.col-md-offset-4.col-xs-10
          = text_field_tag :query, params[:query], placeholder: "Ingrese número de factura, local, proveedor o encargado de la compra", autofocus: true, class: "form-control"
        .col-md-1.col-xs-2
          = submit_tag "Buscar", class: "btn btn-info pull-right"
%br
%br
%table.table
  %th Proveedor
  %th Local
  %th Nº Factura
  %th Fecha Vencimiento
  %th Comprador
  %th Total
  %th Estado
  %th
    - @purchases.each do |purchase|
      %tr
        %td
          = link_to purchase.provider.name, purchase.provider
        %td
          = purchase.store.name
        %td
          = purchase.document_number
        %td
          = purchase.document_number_expiration
        %td
          = purchase.user.email
        %td
          = purchase.created_at
        %td
          = purchase.total
        %td
          = purchase.status_name
        %td
          = link_to 'Ver', purchase_path(purchase), class: 'btn btn-raised btn-success'
          -#TODO refactor con cancancan
          - if purchase.status == 1
            = link_to 'Editar', edit_purchase_path(purchase), class: 'btn btn-raised btn-primary'
          = link_to purchase, method: :delete, data: { confirm: '¿Estás seguro que quieres eliminar esta compra?' }, class: 'btn btn-raised btn-danger' do
            %i.fa.fa-trash-o
            Eliminar
