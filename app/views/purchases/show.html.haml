%h1.header
	Agregar Productos
%br
%br
.container
	%div
		%table.table
			%tr
				%th Local
				%td
					= @purchase.store.name
				%tr
				%th Proveedor
				%td
					= @purchase.provider.name
				%tr
				%th Comprador
				%td
					= @purchase.user.email
				%tr
				%th Estado
				%td
					= @purchase.status_name
				%tr

	.row
		= form_tag(purchase_details_path(purchase: @purchase), :method => "post") do
			-#TODO refactor con cancancan
			- if @purchase.status == 1
				.col-md-2
					= text_field_tag :amount, params[:amount], placeholder: "Cantidad", autofocus: true, class: "form-control"
				.col-md-4
					= text_field_tag :barcode, params[:barcode], placeholder: "Ingrese Codigo de Barras", autofocus: true, class: "form-control barcode"
					-# = select_tag :barcode, options_for_select(@products, "#{@product.id if @product.present?}"), { class: 'barcode form-control' , prompt: "Ingrese Código de Barras"}
			.col-md-4
				-#TODO refactor con cancancan
				- if @purchase.status == 1
					= submit_tag "Agregar", class: "btn btn-success"
					= link_to 'Finalizar', edit_purchase_path(@purchase, origin: "FINISHED"), class: 'btn btn-raised btn-danger'
				- elsif @purchase.status == 2
					= link_to 'Imprimir', edit_purchase_path(@purchase, origin: "CANCELLED"), class: 'btn btn-raised btn-info'
				= link_to 'Anular', edit_purchase_path(@purchase, origin: "CANCELLED"), class: 'btn btn-raised btn-warning'

	%br
	.h3 Productos
	%div
		%br
		%table.table
			%tr
				%th Cantidad
				%th Nombre
				%th Descripción
				%th Unidad
				%th
			- @purchase.purchase_details.each do |purchase_detail|
				%tr
					%td
						= purchase_detail.amount
					%td
						= purchase_detail.product.name
					%td
						= purchase_detail.product.description
					%td
						= purchase_detail.product.unit
					%td
						-#TODO refactor con cancancan
						- if @purchase.status == 1
							= link_to purchase_detail, method: :delete, data: { confirm: '¿Estás seguro que quieres quitar este producto?' }, class: 'btn btn-raised btn-danger' do
								%i.fa.fa-trash-o
								Quitar

	= link_to 'Volver', purchases_path , class: "btn btn-link"

:javascript
	$(document).ready(function() {
		$("#barcode").select2();
	});
