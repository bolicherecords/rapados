%h1.header
  Listado de Despachos
%hr
.row
  .col-md-4.col-xs-5
    = link_to new_dispatch_path, class: 'btn btn-raised btn-success' do
      %i.fa.fa-plus-circle
      Nuevo Despacho
    = link_to new_dispatch_path, class: 'btn btn-info' do
      %i.fa.fa-edit
      Despachos Anulados
  .col-md-8.col-xs-7
    = form_tag(dispatches_path(), :method => "get", id: "search-form") do
      .row
        .col-md-7.col-md-offset-4.col-xs-10
          = text_field_tag :query, params[:query], placeholder: "Ingrese número de factura, local, proveedor o encargado", autofocus: true, class: "form-control"
        .col-md-1.col-xs-2
          = submit_tag "Buscar", class: "btn btn-info pull-right"
%br
%br
%table.table
  %th Local Origen
  %th Local Destino
  %th Fecha
  %th Total
  %th Estado
  %th
    - @dispatches.each do |dispatch|
      %tr
        %td
          = link_to dispatch.origin.name, dispatch.origin
        %td
          = link_to dispatch.destination.name, dispatch.destination
        %td
          = dispatch.created_at
        %td
          = dispatch.total
        %td
          = dispatch.status_name
        %td
          = link_to 'Ver', dispatch_path(dispatch), class: 'btn btn-raised btn-success'
          -#TODO refactor con cancancan
          - if dispatch.status == 1
            = link_to 'Editar', edit_dispatch_path(dispatch), class: 'btn btn-raised btn-primary'
          = link_to dispatch, method: :delete, data: { confirm: '¿Estás seguro que quieres eliminar este despacho?' }, class: 'btn btn-raised btn-danger' do
            %i.fa.fa-trash-o
            Eliminar
